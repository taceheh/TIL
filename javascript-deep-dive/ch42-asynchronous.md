# [JS] 42장. 비동기 프로그래밍 (Asynchronous Programming)

## 1. 비동기란? (Definition)

> "현재 실행 중인 태스크가 종료되지 않아도 다음 태스크를 곧바로 실행하는 방식"

- **핵심 키워드**: `이벤트 루프(Event Loop)`, `콜 스택(Call Stack)`, `태스크 큐(Task Queue)`, `싱글 스레드`
- **한 줄 요약**: 자바스크립트 엔진(머리)은 한 번에 한 가지 일만의 가능성(싱글 스레드)이지만, 브라우저(팔다리)의 도움을 받아 여러 일을 동시에 하는 것처럼의 표현(동시성) 실현.

<br>

## 2. 핵심 전제 지식 (Prerequisites)

이 구조의 이해가 비동기 정복의 필수 요소.

### 2.1 자바스크립트 엔진 vs 브라우저 환경

**JS 엔진 (V8 등)**:
- 콜 스택(Call Stack): 코드 실행의 장소. (하나뿐임 = 싱글 스레드)
- 힙(Heap): 객체 저장의 메모리 공간.

**브라우저 (런타임 환경)**:
- Web API: `setTimeout`, `DOM`, `Fetch`(네트워크) 등 비동기 작업의 실제 수행 처. (멀티 스레드 동작)
- 태스크 큐(Task Queue): 비동기 작업 완료 후 콜백 함수의 대기 줄.
- 이벤트 루프(Event Loop): 매니저 역할 담당.

<br>

## 3. 동작 원리: 이벤트 루프 (Mechanism) 

"JS는 싱글 스레드인데 어떻게 동시에 여러 작업을 하나요?"

**1. 요청**: JS 엔진이 `setTimeout(콜백, 3000)` 만남 시, 이를 브라우저(Web API)에게의 "3초 뒤에 알려줘" 전달 후 즉시 다음 코드 실행. (비동기)

**2. 대기**: 브라우저의 타이머가 3초 경과. (JS 엔진은 그동안 다른 일 진행)

**3. 큐 등록**: 3초 경과 후, 브라우저는 맡겨둔 `콜백 함수`를 태스크 큐에의 줄 세우기 수행.

**4. 감시**: 이벤트 루프는 계속 두 곳의 감시 진행.
- "콜 스택이 비었는가?"
- "태스크 큐에 대기 중인 손님의 존재 여부?"

**5. 실행**: 콜 스택이 텅 빈 후, 이벤트 루프가 태스크 큐의 콜백을 콜 스택으로의 밀어 넣기 수행.

<br>

## 4. 활용 사례 (Use Cases)

### 4.1 타이머 (Timer)

- `setTimeout`, `setInterval`
- 스케줄링(일정 시간 뒤 실행)의 용도 활용.

### 4.2 네트워크 요청 (Ajax, Fetch)

- 서버에서의 데이터 수신 시 화면 정지 방지를 위한 필수 활용.
- 데이터 도착 대기 없이 UI 그리기 작업의 계속 진행.

### 4.3 이벤트 핸들러

- `click`, `scroll` 등의 이벤트도 태스크 큐를 통한 비동기 처리 수행.

<br>

## 5. 자주 발생하는 실수 (Common Mistakes)

### 5.1 `setTimeout(func, 0)`은 0초 뒤에 실행된다?

- 아니요. "최소 0초 뒤에 태스크 큐에의 진입"을 의미.
- 콜 스택에 아주 무거운 작업(for문 100억 번)이의 진행 중이라면, 0초가 아닌 10초 뒤의 실행 가능성 존재. (콜 스택의 완전한 비움 필요!)

### 5.2 실행 순서 착각

```javascript
console.log('A');
setTimeout(() => console.log('B'), 0);
console.log('C');
```

- **결과**: `A` → `C` → `B`
- `B`는 0초 뒤라도 무조건 태스크 큐를 거쳐야 하므로, 동기 코드(`C`)의 완전한 종료 후 실행 가능.

<br>

## 6. 헷갈렸던 부분 (Confusing Points)

### 6.1 싱글 스레드 vs 멀티 스레드

- **JS 엔진**: 싱글 스레드 (일꾼 1명)
- **브라우저**: 멀티 스레드 (일꾼 여러 명)
- 우리는 JS 엔진만의 다룸이므로 "자바스크립트는 싱글 스레드다"라는 표현이 맞지만, 실제로는 브라우저라는 거대한 공장 안에서의 협업 발생.
